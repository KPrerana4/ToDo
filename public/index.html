<html>
<head>
    <title>
        sample
    </title>
    <link rel = "stylesheet" href = "style.css">
</head>

<body>
<form method = "POST" action ="/add_item">
    <h1>To-Do</h1>
    <input type = "text" name = "item" id="item" class = "main">

    <button onclick = "add()">Add</button>
    <br><br>
</form>
<div id = "items"></div>
</body>

<script>
var items = [];
    function add()
    {
        let item = document.getElementById("item").value;
        if(items.indexOf(item) == -1)
        {
            console.log("in if");
            items.push(item);
            updateUI();
        }
    }

    function deleteItem(event)
    {
        let id ="div"+event.target.id;
        document.getElementById(id).style.display = "none";
        items.splice(event.target.id,1);
    }

    function updateUI()
    {
        let elements = "";
        for(let index = 0; index < items.length; index++)
        {
            elements += "<div id ='div"+index+"'>";
            elements += "<form style='style:left;' method='POST' action='/delete_item'>";
            elements += "<button id='"+index+"' class='del' onclick='deleteItem(event)'>Delete</button>";
            elements += "<span onclick='addSubToDoToUI("+index+")'>Add sub ToDo</span>";
            elements += "<input hidden type='text' name='editItem' value='"+items[index]+"'></form>";
            elements += "<form id='form"+index+"' style='style:right'' method='POST' action='/update'>";
            elements += "<input type='text' id='editItem"+index+"' name='editItem' value='"+items[index]+"' onchange='updateItems("+index+")'>";
            elements += "<input hidden type ='text' name='index' value='"+index+"'> <br></form></div>";
        }
        document.getElementById("items").innerHTML = elements;
    }

    function updateItems(index)
    {
        items[index] = document.getElementById("editItem"+index).value;
        document.getElementById("form"+index).submit();
    }

    var subToDos = [];
    function addSubToDoToUI(index)
    {
        document.getElementById("div"+index).innerHTML += "<br><button onclick='addSubToDo('"+index+"')' class='sub subAdd'>Add</button> <input type='text' class='subToDo' name='subToDo'><br>";
    }
</script>
</html>
